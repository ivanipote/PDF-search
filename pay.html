<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accès Premium</title>
    <style>
        body {font-family: Arial, sans-serif;background:#f0f2f5;display:flex;justify-content:center;padding:20px;}
        .card {background:white;padding:25px;border-radius:12px;box-shadow:0 5px 20px rgba(0,0,0,0.1);width:100%;max-width:420px;}
        h2 {text-align:center;color:#333;margin-bottom:20px;}
        input {width:100%;padding:12px;margin:10px 0;border:1px solid #ddd;border-radius:8px;box-sizing:border-box;font-size:16px;}
        button {padding:12px;border:none;border-radius:8px;cursor:pointer;font-size:16px;margin:10px 0;}
        .whatsapp-btn {background:#25D366;color:white;}
        .whatsapp-btn:hover {background:#128C7E;}
        .verify-btn {background:#007bff;color:white;}
        .verify-btn:hover {background:#0056b3;}
        .success {color:green;font-weight:bold;text-align:center;margin:15px 0;}
        .error {color:red;text-align:center;margin:15px 0;}
        .hidden {display:none;}
        .premium {background:#d4edda;padding:20px;border-radius:8px;text-align:center;margin-top:20px;}
    </style>
</head>
<body>

<div class="card">
    <h2>Accès Premium (9.99€)</h2>

    <!-- Formulaire + WhatsApp -->
    <div id="formulaire">
        <p>Remplissez vos infos puis cliquez sur le bouton :</p>
        <input type="text" id="nom" placeholder="Nom (ex: Koffi)" required>
        <input type="text" id="prenom" placeholder="Prénom" required>
        <input type="text" id="telephone" placeholder="Téléphone (ex: 0778904949)" required>

        <button class="whatsapp-btn" onclick="envoyerWhatsApp()">
            Envoyer la demande sur WhatsApp
        </button>
        <p style="font-size:14px;color:#555;">Je vous envoie le code après paiement.</p>
    </div>

    <!-- Vérification du code -->
    <div id="verification" class="hidden">
        <h3>Entrez votre code d'accès :</h3>
        <input type="text" id="code" placeholder="Ex: MG-FI949-251114-" autocomplete="off">
        <button class="verify-btn" onclick="verifier()">Vérifier</button>
        <div id="resultat"></div>
    </div>

    <!-- Contenu Premium -->
    <div id="premium" class="hidden premium">
        <h2>Accès Premium Activé !</h2>
        <p>Tout le contenu premium est débloqué.</p>
    </div>
</div>

<script>
    // TON VRAI NUMÉRO WHATSAPP (déjà correct)
    const WHATSAPP_NUMBER = "2250503588336";

    // Si déjà premium → accès direct
    if (localStorage.getItem('premium') === 'true') {
        document.getElementById('formulaire').classList.add('hidden');
        document.getElementById('verification').classList.add('hidden');
        document.getElementById('premium').classList.remove('hidden');
    }

    function envoyerWhatsApp() {
        const nom = document.getElementById('nom').value.trim();
        const prenom = document.getElementById('prenom').value.trim();
        const tel = document.getElementById('telephone').value.trim();

        if (!nom || !prenom || !tel) {
            alert("Remplissez tous les champs");
            return;
        }

        const message = encodeURIComponent(`\( {nom} \){prenom} ${tel}`);
        const url = `https://wa.me/\( {WHATSAPP_NUMBER}?text= \){message}`;
        window.open(url, '_blank');

        // Passe directement à la vérification du code
        document.getElementById('formulaire').classList.add('hidden');
        document.getElementById('verification').classList.remove('hidden');
    }

    // Liste des codes déjà utilisés (un code = une seule utilisation)
    function getUsedCodes() {
        return JSON.parse(localStorage.getItem('usedCodes') || '[]');
    }
    function addUsedCode(code) {
        const used = getUsedCodes();
        if (!used.includes(code)) used.push(code);
        localStorage.setItem('usedCodes', JSON.stringify(used));
    }

    // Vérification EXACTE de ta logique
    function verifier() {
        const codeSaisi = document.getElementById('code').value.trim().toUpperCase();
        const resultat = document.getElementById('resultat');

        if (getUsedCodes().includes(codeSaisi)) {
            resultat.innerHTML = '<p class="error">Ce code a déjà été utilisé !</p>';
            return;
        }

        const regex = /^(MG-|CD-|IVN-)([A-Z]{2})(\d{3})-(\d{6})-$/;
        const match = codeSaisi.match(regex);
        if (!match) {
            resultat.innerHTML = '<p class="error">Code invalide</p>';
            return;
        }

        const deuxLettres = match[2];
        const troisChiffres = match[3];

        const nom = document.getElementById('nom').value.trim().toUpperCase();
        const tel = document.getElementById('telephone').value.trim();

        const deuxDernieresNom = nom.slice(-2);
        const troisDerniersTel = tel.slice(-3);

        if (deuxLettres === deuxDernieresNom && troisChiffres === troisDerniersTel) {
            addUsedCode(codeSaisi);
            localStorage.setItem('premium', 'true');
            resultat.innerHTML = '<p class="success">Accès Premium Activé !</p>';
            setTimeout(() => location.reload(), 1500);
        } else {
            resultat.innerHTML = '<p class="error">Code incorrect</p>';
        }
    }

    // Valider avec Entrée
    document.getElementById('code')?.addEventListener('keypress', e => {
        if (e.key === 'Enter') verifier();
    });
</script>

</body>
</html>
