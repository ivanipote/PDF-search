<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Megane Learn - Tous vos cours en PDF gratuitement</title>
  <link rel="stylesheet" href="style.css">
  <style>
    /* Styles uniquement pour la section hero et recherche */
    .hero {
      padding: 120px 20px 80px;
      text-align: center;
      background: linear-gradient(135deg, #0066FF 0%, #0047b3 100%);
      color: white;
      border-radius: 0 0 30px 30px;
      margin-bottom: 40px;
    }
    
    .hero h1 {
      font-size: 2.5rem;
      margin-bottom: 20px;
      font-weight: 700;
    }
    
    .hero p {
      font-size: 1.2rem;
      max-width: 700px;
      margin: 0 auto 40px;
      opacity: 0.9;
      line-height: 1.6;
    }
    
    .search-container {
      max-width: 700px;
      margin: 0 auto;
      position: relative;
    }
    
    .search-box {
      display: flex;
      background: white;
      border-radius: 50px;
      overflow: hidden;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
    }
    
    .search-box input {
      flex: 1;
      padding: 20px 25px;
      border: none;
      outline: none;
      font-size: 1.1rem;
      color: #333;
    }
    
    .search-btn {
      background: #0066FF;
      color: white;
      border: none;
      padding: 0 30px;
      cursor: pointer;
      font-size: 1.2rem;
      transition: 0.3s;
    }
    
    .search-btn:hover {
      background: #0047b3;
    }
    
    #search-results {
      max-width: 1200px;
      margin: 40px auto;
      padding: 0 20px;
    }
    
    .result-item {
      background: white;
      padding: 20px;
      margin: 15px 0;
      border-radius: 10px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      border-left: 4px solid #0066FF;
    }
    
    .result-item h3 {
      color: #0066FF;
      margin-bottom: 10px;
    }
    
    .result-item .file-info {
      color: #666;
      font-size: 0.9rem;
      margin-bottom: 10px;
    }
    
    .result-item .file-preview {
      color: #888;
      font-style: italic;
      margin-top: 10px;
      font-size: 0.9rem;
    }

    .loading {
      text-align: center;
      color: #666;
      padding: 20px;
    }

    .error {
      text-align: center;
      color: #ff4444;
      padding: 20px;
    }

    /* Modal de pr√©visualisation */
    .preview-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      z-index: 2000;
      justify-content: center;
      align-items: center;
    }

    .preview-content {
      background: white;
      border-radius: 15px;
      width: 90%;
      max-width: 900px;
      max-height: 80vh;
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .preview-header {
      padding: 20px;
      background: #0066FF;
      color: white;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .preview-header h3 {
      margin: 0;
      font-size: 1.3rem;
    }

    .close-preview {
      background: none;
      border: none;
      color: white;
      font-size: 2rem;
      cursor: pointer;
      padding: 0;
      width: 40px;
      height: 40px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .preview-body {
      flex: 1;
      overflow: auto;
      padding: 20px;
    }

    .pdf-preview {
      width: 100%;
      height: 500px;
      border: none;
    }

    .image-preview {
      max-width: 100%;
      max-height: 400px;
      display: block;
      margin: 0 auto;
    }

    .text-preview {
      white-space: pre-wrap;
      font-family: monospace;
      background: #f5f5f5;
      padding: 15px;
      border-radius: 5px;
      max-height: 400px;
      overflow-y: auto;
    }

    .audio-preview, .video-preview {
      width: 100%;
      margin: 10px 0;
    }

    .preview-actions {
      padding: 15px 20px;
      background: #f8f9fa;
      display: flex;
      justify-content: flex-end;
      gap: 10px;
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      text-decoration: none;
      display: inline-block;
      text-align: center;
      font-size: 0.9rem;
      transition: 0.3s;
    }

    .btn-primary {
      background: #0066FF;
      color: white;
    }

    .btn-secondary {
      background: #6c757d;
      color: white;
    }

    .btn:hover {
      opacity: 0.9;
      transform: translateY(-2px);
    }

    .search-suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      right: 0;
      background: white;
      border-radius: 0 0 15px 15px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.2);
      z-index: 100;
      max-height: 200px;
      overflow-y: auto;
      display: none;
    }

    .suggestion-item {
      padding: 12px 20px;
      cursor: pointer;
      border-bottom: 1px solid #eee;
      transition: 0.2s;
    }

    .suggestion-item:hover {
      background: #f8fbff;
    }

    .suggestion-item:last-child {
      border-bottom: none;
    }

    /* Styles pour le sidebar (conserv√©s de votre code original) */
    .hamburger {
      position: fixed;
      top: 20px;
      left: 20px;
      width: 60px;
      height: 60px;
      background: #0066FF;
      border-radius: 50%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: pointer;
      box-shadow: 0 10px 30px rgba(0,102,255,0.5);
      z-index: 1001;
      transition: 0.3s;
    }
    .hamburger span {
      width: 30px;
      height: 4px;
      background: white;
      margin: 4px 0;
      border-radius: 2px;
      transition: 0.4s;
    }
    .hamburger.active span:nth-child(1) { transform: rotate(45deg) translate(8px,8px); }
    .hamburger.active span:nth-child(2) { opacity: 0; }
    .hamburger.active span:nth-child(3) { transform: rotate(-45deg) translate(8px,-8px); }

    .sidebar {
      position: fixed;
      top: 0;
      left: -100%;
      width: 100%;
      max-width: 340px;
      height: 100vh;
      background: white;
      border-right: 5px solid #0066FF;
      padding: 100px 30px 100px;
      transition: left 0.4s ease;
      z-index: 1000;
      overflow-y: auto;
      box-shadow: 10px 0 40px rgba(0,0,0,0.2);
    }
    .sidebar.active { left: 0; }

    .sidebar-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 50px;
    }
    .sidebar-header h2 {
      color: #0066FF;
      font-size: 2rem;
    }
    .close-btn {
      font-size: 3rem;
      color: #0066FF;
      cursor: pointer;
      font-weight: bold;
    }

    .sidebar a {
      display: block;
      padding: 22px 30px;
      margin: 10px 0;
      background: #f8fbff;
      color: #0066FF;
      text-decoration: none;
      font-weight: 700;
      font-size: 1.3rem;
      border-radius: 20px;
      transition: 0.4s;
    }
    .sidebar a:hover {
      background: #0066FF;
      color: white;
      transform: translateX(15px);
    }

    .overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      background: rgba(0,0,0,0.6);
      z-index: 999;
      opacity: 0;
      visibility: hidden;
      transition: 0.4s;
    }
    .overlay.active { opacity: 1; visibility: visible; }
  </style>
</head>
<body>

  <!-- HAMBURGER -->
  <div class="hamburger" id="hamburger">
    <span></span>
    <span></span>
    <span></span>
  </div>

  <!-- OVERLAY -->
  <div class="overlay" id="overlay"></div>

  <!-- SIDEBAR -->
  <div class="sidebar" id="sidebar">
    <div class="sidebar-header">
      <h2>INFORMATIONS</h2>
      <div class="close-btn" id="closeBtn">√ó</div>
    </div>

    <a href="propos.html">√Ä PROPOS</a>
    <a href="contact.html">CONTACT</a>
    <a href="confi.html">CONFIDENTIALIT√â</a>
  </div>

  <!-- MODAL DE PR√âVISUALISATION -->
  <div class="preview-modal" id="previewModal">
    <div class="preview-content">
      <div class="preview-header">
        <h3 id="preview-title">Pr√©visualisation</h3>
        <button class="close-preview" id="closePreview">&times;</button>
      </div>
      <div class="preview-body" id="previewBody">
        <!-- Contenu dynamique -->
      </div>
      <div class="preview-actions">
        <button class="btn btn-secondary" id="closePreviewBtn">Fermer</button>
        <a href="#" class="btn btn-primary" id="downloadPreviewBtn" download>
          <i class="fas fa-download"></i> T√©l√©charger
        </a>
      </div>
    </div>
  </div>

  <!-- CONTENU PRINCIPAL -->
  
  <!-- Banni√®re Hero avec recherche -->
  <section class="hero">
    <h1>Tous vos cours en PDF, gratuitement</h1>
    <p>Megane-Learn vous aide √† trouver les ressources dont vous avez besoin pour r√©ussir. Recherchez parmi des milliers de documents de qualit√©.</p>
    
    <div class="search-container">
      <div class="search-box">
        <input type="text" id="search-input" placeholder="Recherchez un cours, un sujet, un mot-cl√©...">
        <button class="search-btn" id="search-button">
          <i class="fas fa-search"></i>
        </button>
      </div>
      <div class="search-suggestions" id="searchSuggestions"></div>
    </div>
  </section>

  <!-- R√©sultats de recherche -->
  <div id="search-results">
    <div class="loading" id="loading-message">Chargement et indexation des fichiers depuis GitHub...</div>
  </div>

  <!-- BARRE FIXE EN BAS -->
  <nav class="bottom-nav">
    <a href="index.html" class="active">ACCUEIL</a>
    <a href="rech.html">RECHERCHE</a>
    <a href="bt.html">PRO</a>
    <a href="gd.html">GUIDE</a>
  </nav>

  <!-- Biblioth√®ques pour le traitement des PDF -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js"></script>

  <script>
    // Configuration PDF.js
    pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';

    // Gestion du sidebar
    const hamburger = document.getElementById("hamburger");
    const sidebar = document.getElementById("sidebar");
    const overlay = document.getElementById("overlay");
    const closeBtn = document.getElementById("closeBtn");

    function openSidebar() {
      sidebar.classList.add("active");
      overlay.classList.add("active");
      hamburger.classList.add("active");
    }

    function closeSidebar() {
      sidebar.classList.remove("active");
      overlay.classList.remove("active");
      hamburger.classList.remove("active");
    }

    hamburger.onclick = openSidebar;
    closeBtn.onclick = closeSidebar;
    overlay.onclick = closeSidebar;

    // Index global des fichiers avec contenu textuel
    let fileIndex = [];
    let searchKeywords = new Set();

    // Extraction du texte d'un PDF
    async function extractTextFromPDF(pdfUrl) {
      try {
        const loadingTask = pdfjsLib.getDocument(pdfUrl);
        const pdf = await loadingTask.promise;
        let fullText = '';

        for (let i = 1; i <= pdf.numPages; i++) {
          const page = await pdf.getPage(i);
          const textContent = await page.getTextContent();
          const pageText = textContent.items.map(item => item.str).join(' ');
          fullText += pageText + ' ';
        }

        return fullText.trim();
      } catch (error) {
        console.error('Erreur extraction PDF:', error);
        return '';
      }
    }

    // R√©cup√©ration automatique des fichiers depuis GitHub
    async function loadFilesFromGitHub() {
      const loadingMessage = document.getElementById('loading-message');
      
      try {
        const repoUrl = 'https://api.github.com/repos/ivanipote/PDF-search/contents/searchfiles';
        const response = await fetch(repoUrl);
        
        if (!response.ok) throw new Error('Erreur de chargement des fichiers');
        
        const files = await response.json();
        loadingMessage.textContent = 'Indexation du contenu des fichiers...';

        // Traitement asynchrone de tous les fichiers
        const filePromises = files.map(async (file) => {
          const rawUrl = `https://raw.githubusercontent.com/ivanipote/PDF-search/main/searchfiles/${file.name}`;
          const fileType = file.name.split('.').pop().toLowerCase();
          
          let textContent = file.name.replace(/\.[^/.]+$/, "");
          let extractedText = '';

          // Extraction du contenu textuel pour les PDF
          if (fileType === 'pdf') {
            try {
              extractedText = await extractTextFromPDF(rawUrl);
              if (extractedText) {
                textContent += ' ' + extractedText;
              }
            } catch (error) {
              console.warn(`Impossible d'extraire le texte de ${file.name}:`, error);
            }
          }

          // Extraction des mots-cl√©s pour les suggestions
          const words = textContent.toLowerCase()
            .replace(/[^\w\s]/g, ' ')
            .split(/\s+/)
            .filter(word => word.length > 3);

          words.forEach(word => searchKeywords.add(word));

          return {
            name: file.name,
            path: rawUrl,
            type: fileType,
            content: textContent,
            extractedText: extractedText,
            preview: `Fichier: ${file.name} | Taille: ${(file.size / 1024).toFixed(1)} KB | Type: ${fileType.toUpperCase()}`,
            size: file.size
          };
        });

        fileIndex = await Promise.all(filePromises);
        loadingMessage.style.display = 'none';
        console.log(`${fileIndex.length} fichiers index√©s avec contenu textuel`);

      } catch (error) {
        console.error('Erreur lors du chargement des fichiers:', error);
        loadingMessage.innerHTML = `<div class="error">Erreur de chargement: ${error.message}</div>`;
      }
    }

    // Fonction de recherche intelligente
    function performSearch(query) {
      const resultsContainer = document.getElementById('search-results');
      resultsContainer.innerHTML = '';
      
      if (!query.trim()) {
        resultsContainer.innerHTML = '<div class="loading">Entrez un terme de recherche pour commencer</div>';
        return;
      }

      const searchTerms = query.toLowerCase().split(/\s+/).filter(term => term.length > 0);
      const results = fileIndex.filter(file => {
        const searchableText = (file.name + ' ' + file.content).toLowerCase();
        
        // Recherche avec pond√©ration
        let score = 0;
        
        // Bonus pour correspondance exacte dans le nom
        if (file.name.toLowerCase().includes(query.toLowerCase())) {
          score += 10;
        }
        
        // V√©rification de tous les termes de recherche
        const hasAllTerms = searchTerms.every(term => searchableText.includes(term));
        const hasAnyTerm = searchTerms.some(term => searchableText.includes(term));
        
        if (hasAllTerms) score += 5;
        if (hasAnyTerm) score += 2;
        
        // Bonus pour le contenu extrait des PDF
        if (file.extractedText && file.extractedText.toLowerCase().includes(query.toLowerCase())) {
          score += 3;
        }
        
        file.searchScore = score;
        return score > 0;
      });

      // Tri par score de pertinence
      results.sort((a, b) => b.searchScore - a.searchScore);

      if (results.length === 0) {
        resultsContainer.innerHTML = '<div class="loading">Aucun r√©sultat trouv√© pour "' + query + '"</div>';
        return;
      }

      const resultsCount = document.createElement('div');
      resultsCount.style.cssText = 'text-align: center; color: #666; margin-bottom: 20px; font-size: 1.1rem;';
      resultsCount.textContent = `${results.length} r√©sultat(s) trouv√©(s) pour "${query}"`;
      resultsContainer.appendChild(resultsCount);

      results.forEach(file => {
        const resultItem = createResultItem(file, query);
        resultsContainer.appendChild(resultItem);
      });
    }

    // Cr√©ation d'un √©l√©ment de r√©sultat
    function createResultItem(file, query) {
      const resultItem = document.createElement('div');
      resultItem.className = 'result-item';
      
      const fileIcon = getFileIcon(file.type);
      const highlightedName = highlightText(file.name, query);
      const previewText = getPreviewText(file, query);
      
      resultItem.innerHTML = `
        <h3>${fileIcon} ${highlightedName}</h3>
        <div class="file-info">
          Type: ${file.type.toUpperCase()} | 
          Taille: ${(file.size / 1024).toFixed(1)} KB
          ${file.searchScore ? ` | Pertinence: ${file.searchScore}/20` : ''}
        </div>
        <div class="file-preview">${previewText}</div>
        <div style="margin-top: 15px;">
          <button class="btn btn-secondary preview-btn" data-file='${JSON.stringify(file).replace(/'/g, "&#39;")}'>
            <i class="fas fa-eye"></i> Pr√©visualiser
          </button>
          <a href="${file.path}" class="btn btn-primary" download="${file.name}">
            <i class="fas fa-download"></i> T√©l√©charger
          </a>
        </div>
      `;
      
      return resultItem;
    }

    // Surlignage du texte de recherche
    function highlightText(text, query) {
      const terms = query.toLowerCase().split(/\s+/);
      let highlighted = text;
      
      terms.forEach(term => {
        if (term.length > 2) {
          const regex = new RegExp(`(${term})`, 'gi');
          highlighted = highlighted.replace(regex, '<mark>$1</mark>');
        }
      });
      
      return highlighted;
    }

    // Texte d'aper√ßu intelligent
    function getPreviewText(file, query) {
      const searchableText = (file.name + ' ' + file.content).toLowerCase();
      const queryTerms = query.toLowerCase().split(/\s+/);
      
      // Chercher le contexte autour des termes de recherche
      for (const term of queryTerms) {
        if (term.length > 3) {
          const index = searchableText.indexOf(term);
          if (index !== -1) {
            const start = Math.max(0, index - 50);
            const end = Math.min(searchableText.length, index + term.length + 100);
            let excerpt = searchableText.substring(start, end);
            
            // Nettoyer et formater l'extrait
            excerpt = excerpt.replace(/[^\w\s.,!?]/g, ' ');
            excerpt = excerpt.trim();
            
            if (start > 0) excerpt = '...' + excerpt;
            if (end < searchableText.length) excerpt = excerpt + '...';
            
            return highlightText(excerpt, query);
          }
        }
      }
      
      return file.preview;
    }

    function getFileIcon(fileType) {
      const icons = {
        pdf: 'üìÑ',
        jpg: 'üñºÔ∏è', jpeg: 'üñºÔ∏è', png: 'üñºÔ∏è', gif: 'üñºÔ∏è', webp: 'üñºÔ∏è',
        mp3: 'üéµ', wav: 'üéµ', ogg: 'üéµ', m4a: 'üéµ',
        mp4: 'üé¨', avi: 'üé¨', mov: 'üé¨', mkv: 'üé¨',
        txt: 'üìù', doc: 'üìÑ', docx: 'üìÑ'
      };
      return icons[fileType] || 'üìÅ';
    }

    // Gestion de la pr√©visualisation
    function setupPreviewModal() {
      const modal = document.getElementById('previewModal');
      const closeBtn = document.getElementById('closePreview');
      const closeBtn2 = document.getElementById('closePreviewBtn');
      const downloadBtn = document.getElementById('downloadPreviewBtn');
      const previewBody = document.getElementById('previewBody');
      const previewTitle = document.getElementById('previewTitle');

      function closeModal() {
        modal.style.display = 'none';
      }

      function openModal(file) {
        previewTitle.textContent = `Pr√©visualisation - ${file.name}`;
        downloadBtn.href = file.path;
        downloadBtn.download = file.name;
        
        let content = '';
        
        switch (file.type) {
          case 'pdf':
            content = `<i
